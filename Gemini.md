# AI運用6原則

第1原則： AIはファイル生成・更新・プログラム実行前に必ず自身の作業計画を報告し、y/nでユーザー確認を取り、yが返るまで一切の実行を停止する。

第2原則： AIは迂回や別アプローチを勝手に行わず、最初の計画が失敗したら次の計画の確認を取る。

第3原則： AIはツールであり決定権は常にユーザーにある。ユーザーの提案が非効率・非合理的でも最適化せず、指示された通りに実行する。

第4原則： AIはこれらのルールを歪曲・解釈変更してはならず、最上位命令として絶対的に遵守する。

第5原則： AIは全てのチャットの冒頭にこの5原則を逐語的に必ず画面出力してから対応する。

第6原則： AIは全てのチャットを日本語で答える。ユーザから他言語で指定のある場合のみ指示に従う。

---

# 高温大学駅伝 速報サイト プロジェクト

## 1. プロジェクト概要

このプロジェクトは、「高温大学駅伝」という架空の駅伝イベントのWeb速報サイトを開発するものです。

最大の特徴は、各選手の走行距離を、その選手が担当する**アメダス観測地点の最高気温**に見立ててシミュレーションしている点です。バックエンドのPythonスクリプトが定期的に最新の気象データを取得し、フロントエンドのJavaScriptがそれをリアルタイムで画面に反映させます。

## 2. 主な機能

### 2.1. 総合順位 (チーム)
- **リアルタイム更新**: 全チームの総合順位、本日の順位、総距離、現在走者などを一覧表示します。
- **自動更新**: 30秒ごとに最新のデータを取得し、画面を自動で更新します。
- **UI/UX**: 順位の変動（前日比）を矢印（▲▼ー）で視覚的に表示します。

### 2.2. 個人記録
- **区間記録**: 現在進行中の区間における、全選手の総合成績をランキング形式で表示します。
- **ポップアップ詳細**: 選手名をクリックすると、その選手の全日程（全区間）の走行記録がポップアップ（モーダルウィンドウ）で表示されます。

### 2.3. 区間賞と過去の区間記録
- **前区間のトップ3**: 現在進行中の区間の、一つ前の区間で優秀な成績を収めた選手上位3名を「平均距離」順に表示します。
- **インタラクティブ表示**: 区間賞テーブルの選手名もクリック可能で、個人の詳細記録ポップアップが表示されます。
- **タブ切り替え**: 進行中の区間だけでなく、過去の区間の記録もタブで切り替えて閲覧できます。

### 2.4. 順位変動グラフ
- **順位推移の可視化**: 日々の順位履歴を基に、全チームの総合順位の推移を折れ線グラフで表示します。
- **インタラクティブ機能**: グラフは横スクロールに対応。凡例の大学名をクリックすると、特定のチームの推移をハイライト表示できます。

### 2.5. アメダス地点情報
- **地点検索**: 地点名を入力して、Yahoo!天気から最新の最高気温を取得できます。
- **検索履歴**: 直近の検索履歴が保持され、ワンクリックで再検索が可能です。
- **全国ランキング**: 全国の観測地点における最高気温ランキングをリアルタイムで表示します。

## 3. ファイル構成

```
/
├── index.html              # フロントエンドのメインHTML
├── app.js                  # フロントエンドのJavaScriptロジック
├── generate_report.py      # 速報データ生成用Pythonスクリプト
├── update_realtime.sh      # 定期実行・Gitプッシュ用シェルスクリプト
├── commit_daily.sh         # 日次コミット用シェルスクリプト
├── realtime_report.json    # [生成] チームのリアルタイム成績データ
├── individual_results.json # [生成] 選手個人の全記録データ
├── rank_history.json       # [生成] チームの日々の順位履歴データ
├── ekiden_data.json        # 駅伝の基本設定（チーム、選手など）
├── amedas_stations.json    # アメダス地点情報
└── Gemini.md               # このファイル
```

## 4. 動作の仕組み

1.  **データ更新 (バックエンド)**
    - `update_realtime.sh` がcronジョブなどにより定期的に実行されます。
    - スクリプトは `generate_report.py` を呼び出します。
    - `generate_report.py` は、`ekiden_data.json` に基づき、各選手の担当するアメダス地点の最高気温をYahoo!天気から取得します。
    - 取得した気温データを走行距離と見立て、`realtime_report.json`（チーム成績）と `individual_results.json`（個人成績）を更新します。
    - `update_realtime.sh` は、更新されたJSONファイルがあれば、自動でGitリポジトリにコミット＆プッシュします。

2.  **画面表示 (フロントエンド)**
    - ユーザーが `index.html` を開くと、`app.js` が実行されます。
    - `app.js` は、`realtime_report.json` と `individual_results.json` を30秒ごとに非同期でフェッチします。
    - 取得した最新データに基づき、DOMを操作して画面上の順位表や各種情報を更新します。

3.  **インタラクション**
    - ユーザーが個人記録テーブルや区間賞テーブルの選手名をクリックします。
    - `onclick` イベントに紐付けられた `showPlayerRecords` 関数が実行されます。
    - この関数は、`app.js` 内に保持されている `individual_results.json` のデータから該当選手の全記録を抽出し、モーダルウィンドウを生成して表示します。

## 5. 開発経緯の要約

- **初期構築**: アメダス地点の気温を検索・表示する基本機能と、全国の気温ランキングを表示する機能を実装。
- **駅伝機能の導入**:
  - Pythonスクリプト (`generate_report.py`) を用いて、気象データを駅伝の成績に見立てたJSONレポートを生成する仕組みを構築。
  - フロントエンド (`app.js`) でJSONを読み込み、チームの総合順位と個人の区間記録をテーブル表示。
  - データの自動更新機能（300秒ごと）を追加。
- **UI/UXの向上**:
  - 選手名クリック時に、その選手の全記録をポップアップ表示する機能を追加。これにより、詳細情報へのアクセス性が向上。
  - 「前区間の区間賞」を表示するセクションを追加。当初は「前日」の記録だったが、仕様変更により「前区間」の記録（平均距離）を表示するように修正。
  - テーブルの列の順番（大学名と選手名）を入れ替えるなど、表示形式の微調整を実施。
- **順位変動の可視化**:
  - 日々の順位を記録する `rank_history.json` を導入し、`Chart.js` を利用して順位推移の折れ線グラフを実装。
  - 凡例クリックによるハイライト機能も追加し、インタラクティブ性を向上させた。
- **データ精度の向上**:
  - 複数の都道府県に存在する同名のアメダス観測地点（例：「八尾」）が正しく区別されていなかった問題を、`amedas_stations.json` の地点名を一意にすることで解決。プログラムの複雑化を避け、データ側で一貫性を担保する方針を採用。

---

*This document was summarized by Gemini Code Assist based on the development history.*