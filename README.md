# 高温大学駅伝 速報サイト

このプロジェクトは、「高温大学駅伝」という架空の駅伝イベントのWeb速報サイトです。

最大の特徴は、各選手の走行距離を、その選手が担当する**アメダス観測地点の最高気温**に見立ててシミュレーションしている点です。バックエンドのPythonスクリプトが定期的に最新の気象データを取得し、フロントエンドのJavaScriptがそれをリアルタイムで画面に反映させます。

## 🌐 デモ

GitHub Pagesで公開中: [https://threeblind.github.io/maxweather/](https://threeblind.github.io/maxweather/)

## 🚀 機能
- **速報マップ**: Leaflet.jsを利用し、コース、中継所、全チームの現在位置をリアルタイム表示。マーカーは大学の短縮名で表示され、追跡モードで「全選手表示」や「コース全体表示」も可能です。
- **総合順位**: 全チームのリアルタイム順位、現在走者、総距離などを1分ごとに自動更新。スマートフォンでは短縮名を使った簡易表示と、ボタンで切り替えられるPC版の詳細表示を両立しています。
- **順位推移**: 各チームが区間を通過した時点での総合順位をマトリクス形式で表示。スマートフォンでは短縮名で表示されます。
- **順位変動グラフ**: 全チームの総合順位の推移を折れ線グラフで可視化。（区間順位セクションからモーダルで表示）
- **個人記録**: 現在進行中の区間における、選手の走行距離をランキング形式で表示。スマートフォンでは短縮名で表示され、選手名クリックで全日程の記録をポップアップ表示できます。
- **区間記録**: 完了した区間ごとの全選手の成績をランキング形式で表示。スマートフォンでは短縮名で表示されます。
- **監督談話室**: 夜間（19時〜翌7時）の監督や実況担当者の会話をチャット形式で表示。自動更新はされず、じっくり読むことができます。
- **速報コメント**: 首位交代などのイベントに加え、日中（7時〜19時）に投稿された監督の最新のつぶやき（投稿10分以内）を最優先で表示。クリックで全文を閲覧可能です。
- **エントリーリスト**: 全チームの登録選手、監督、チーム紹介などをカード形式で表示。
- **大会概要**: 大会ルールやスケジュールなどの詳細情報を表示。
- **アメダス地点情報**: 地点名での気温検索や、全国の最高気温ランキングを表示。

## 🛠️ 仕組み

1.  **データ更新 (バックエンド)**
    - **日中 (7時〜19時)**: `update_realtime.sh` が `generate_report.py` を実行。各選手の走行距離（=気温）を算出し、`realtime_report.json` などの速報ファイルを更新。同時に、5chスレッドから監督の最新コメントを取得し、速報コメントに反映させます。
    - **夜間 (19時〜翌7時)**: `update_manager_comments.sh` が `fetch_manager_comments.py` を実行。5chスレッドから監督たちの会話を取得し、`manager_comments.json` を生成します。
    - **日次確定**: `commit_daily.sh` が深夜に実行され、その日の最終結果を `ekiden_state.json` に保存します。
    - これらのシェルスクリプトはcronジョブとして定期実行され、変更があった場合は自動でGitリポジトリにプッシュされます。

2.  **画面表示 (フロントエンド)**
    - `app.js` が、リポジトリ上の各種JSONファイルを1分ごとにフェッチします（監督談話室を除く）。
    - 最新データに基づき、DOMを操作して画面上の順位表や各種情報を更新します。

## 📊 自動生成される主要ファイル

このプロジェクトでは、以下の主要なJSONファイルが10分ごとに自動で更新されます。各ファイルの内容は以下の通りです。

### 1. `realtime_report.json` - チームの総合速報

このファイルは、**現在のレース状況をまとめた最も重要なファイル**です。サイトのトップに表示される「総合順位」テーブルや「速報マップ」の元データとなります。

- **主な内容**:
    - `updateTime`: データが更新された時刻
    - `raceDay`: 大会何日目か
    - `breakingNewsComment`: 「首位交代！」などの速報コメント
    - `teams`: 全チームの最新情報リスト
        - `overallRank`: 最新の総合順位
        - `runner`: 現在の走者名
        - `todayDistance`: 本日の走行距離（＝気温）
        - `totalDistance`: 全日程での合計走行距離
        - `previousRank`: 前日の順位

### 2. `runner_locations.json` - ランナーの地図上の位置

このファイルは、**速報マップに各チームのピンを表示するための座標データ**です。

- **主な内容**:
    - `rank`: 総合順位
    - `team_name`: 大学名
    - `total_distance_km`: 総合距離
    - `latitude`: 緯度
    - `longitude`: 経度

### 3. `individual_results.json` - 全選手の個人記録

このファイルは、**全選手の全日程における走行記録を蓄積したデータベース**です。「個人記録」や「区間記録」セクションの元データとなります。

- **主な内容**:
    - 選手名をキーとしたオブジェクト形式になっています。
    - `totalDistance`: その選手の全日程での合計走行距離
    - `records`: 日ごとの走行記録リスト
        - `day`: 大会何日目か
        - `leg`: 担当した区間
        - `distance`: その日に走った距離（＝気温）

### 4. `rank_history.json` - 日ごとの順位履歴

このファイルは、**順位変動グラフ（日ごと）を描画するためのデータ**です。毎日の最終的な順位と総距離が記録されています。

- **主な内容**:
    - `dates`: 記録されている日付のリスト
    - `teams`: 各チームの履歴データ
        - `ranks`: 日ごとの総合順位のリスト
        - `distances`: 日ごとの総合距離のリスト

### 5. `leg_rank_history.json` - 区間通過時点の順位履歴

このファイルは、**「順位推移」テーブル（マトリクス形式）を表示するためのデータ**です。各チームが各区間を走り終えた（タスキを渡した）瞬間の総合順位を記録しています。

- **主な内容**:
    - `teams`: 各チームの履歴データ
        - `leg_ranks`: 1区から10区までの通過時点での総合順位のリスト。まだ通過していない区間は `null` になります。

### 6. `manager_comments.json` - 監督たちの夜間コメント

このファイルは、**夜間（19:00〜翌朝7:00）に投稿された監督や実況担当者のコメント**を時系列で記録したものです。「監督談話室」セクションの元データとなります。

- **主な内容**: 投稿時刻、投稿者名、公式監督名、コテハン、コメント本文（HTML）

## 📊 主要技術

- **フロントエンド**: HTML, CSS, JavaScript (Vanilla JS)
- **バックエンド**: Python, Shell Script
- **データソース**: Yahoo!天気
- **ホスティング**: GitHub Pages

## 🔧 ローカルでの動かし方

### フロントエンドの確認

```bash
# ローカルサーバーを起動（例：Python）
python -m http.server 8000

# ブラウザでアクセス
# http://localhost:8000
```

## 📝 ライセンス

MIT License

## 🤝 コントリビューション

プルリクエストやイシューの報告を歓迎します！

## ⚠️ 注意事項

- このアプリケーションはYahoo!天気のデータを使用しています
- データの取得にはプロキシサービスを使用しているため、レスポンス時間が遅い場合があります
- 商用利用の場合は、適切なAPIの使用を検討してください